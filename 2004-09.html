<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="ja-JP">
<head><script type="text/javascript" src="https://web-static.archive.org/_static/js/bundle-playback.js?v=Hk4-lkW3" charset="utf-8"></script>
<script type="text/javascript" src="https://web-static.archive.org/_static/js/wombat.js?v=txqj7nKC" charset="utf-8"></script>
<script>window.RufflePlayer=window.RufflePlayer||{};window.RufflePlayer.config={"autoplay":"on","unmuteOverlay":"hidden","showSwfDownload":true};</script>
<script type="text/javascript" src="https://web-static.archive.org/_static/js/ruffle/ruffle.js"></script>
<script type="text/javascript">
    __wm.init("https://web.archive.org/web");
  __wm.wombat("http://www2.coins.tsukuba.ac.jp:80/~i021216/diary/?date=200409","20040912163845","https://web.archive.org/","web","https://web-static.archive.org/_static/",
	      "1095007125");
</script>
<link rel="stylesheet" type="text/css" href="https://web-static.archive.org/_static/css/banner-styles.css?v=1utQkbB3" />
<link rel="stylesheet" type="text/css" href="https://web-static.archive.org/_static/css/iconochive.css?v=3PDvdIFv" />
<!-- End Wayback Rewrite JS Include -->

	<meta http-equiv="Content-Type" content="text/html; charset=EUC-JP">
	<meta name="generator" content="tDiary 2.0.0">
	<meta http-equiv="Last-Modified" content="Sun, 12 Sep 2004 07:49:31 GMT">
	<meta http-equiv="Content-Script-Type" content="text/javascript; charset=EUC-JP">
	<meta name="author" content="水島宏太">
	<link rev="made" href="mailto:hau51010@tree.odn.ne.jp">
	<link rel="index" title="トップ" href="http://www2.coins.tsukuba.ac.jp/~i021216/">
	<link rel="start" title="最新" href="./">
	<meta http-equiv="content-style-type" content="text/css">
	<link rel="stylesheet" href="/web/20040912163845cs_/http://www2.coins.tsukuba.ac.jp/~i021216/diary/theme/base.css" type="text/css" media="all">
	<link rel="stylesheet" href="/web/20040912163845cs_/http://www2.coins.tsukuba.ac.jp/~i021216/diary/theme/default/default.css" title="default" type="text/css" media="all">
	<title>println '日記'(2004-09)</title>
	
</head>
<body>


<div class="adminmenu">
<span class="adminmenu"><a href="https://web.archive.org/web/20040912163845/http://www2.coins.tsukuba.ac.jp/~i021216/">トップ</a></span>
<span class="adminmenu"><a href="./">最新</a></span>
<span class="adminmenu"><a href="update.rb">追記</a></span>
</div>
<h1>println '日記'</h1>
<div class="calendar">
<div class="year">2004|<a href="./?date=200409">09</a>|</div>
</div>

<hr class="sep">


	
<div class="day">
<h2><span class="date"><a href="./?date=20040909">2004-09-09</a></span> <span class="title">日記を始めることにする</span></h2>

<div class="body">

<div class="section">
<h3><a href="./?date=20040909#p01"><span class="sanchor">_</span></a> 日記を始めることにする</h3><p>今更だが、日記を始めることにした。主にGroovy、PnutsなどのJava系スクリプト言語関係のことを書く予定。</p></div><div class="section">
<h3><a href="./?date=20040909#p02"><span class="sanchor">_</span></a> Nice                                                           </h3><p>
以前にちょっとだけ触ってみた<a href="https://web.archive.org/web/20040912163845/http://nice.sourceforge.net/">Nice</a>について調べてみる。
　Niceは、Javaをベースに高階関数、マルチメソッド、パラメータ型、キーワード引数、省略可能引数、Option Typesなどの機能を追加した言語で、処理系は、Java VM用のコードを吐くコンパイラとなっている。
</p>
<p>
マルチメソッド、キーワード引数などは、他の言語でもよく見かけるが、        
 <a href="https://web.archive.org/web/20040912163845/http://nice.sourceforge.net/manual.html#optionTypes">Option Types</a>は、他の言語ではあまり見かけない機能だ。Option Typesとは、値としてnullを許す型で、それだけ見ると、珍しくもなんともないのだが、Niceでは面白いことに、変数の型はデフォルトでnullを代入できないのだ。例えば、以下のようなコードを書くと、sはnullを代入できない型になり、もしsにnullが代入され得るようなコードを書くと、コンパイルエラーになる。
</p>
<pre>
let String s = "Hello";//nullは代入できない
</pre>
<p>
もし、nullを代入可能にしたければ、型名の頭に'?'を付けて、次のように宣言する。
</p>
<pre>
let ?String s = "Hello";//nullが代入可能
</pre>
<p>
この機能は、大変面白い機能なんじゃないかと思う。例えば、Mapにキーを与えて値を取得するとき、返って来た値がnullかどうかをチェックする必要がある場合は多いが、この機能があれば、もし仮にnullかどうかのチェックを忘れたとしても、コンパイルエラーになってくれる。
</p>
<p>
しかし、このチェック機能、どこまでちゃんと働くのだろうか。それを確かめるために、以下のコードを書いて実験してみることにした。このコードでは、if文の中では、valueは絶対にnullになり得ないが、それをコンパイラが判断できるかどうか。
</p>
<pre>
void main(String[] args){
	let Map<string, int> map = new HashMap();
	map.put("A", 0);
	map.put("B", 1);
	map.put("C", 2);
	?int value = map.get("E");
	if(value != null || false){
		int value2 = value;
	}
}
</pre>
<p>
このコードをコンパイルしてみると、以下のエラーメッセージが出力された。
</p>
<pre>
nice.lang: parsing
example: parsing
example: typechecking
　<br>
C:\programs\nice\.\example\option_type.nice: line 8, column 21:
Unused local variable value2
　<br>
C:\programs\nice\.\example\option_type.nice: line 8, column 21:
The value value cannot be assigned to value2 because it might be null.
　<br>
To allow value2 to contain the null value, it should be declared as:
?nice.lang.int value2
</pre>
<p>
どうやら、論理式の中身までは見ておらず、nullかどうかを判断する式(value != null)と他の式が、||でつながれているかどうかだけを見ているようだ。となると、&amp;&amp;の場合はどうなるだろうか。以下のコードも、先ほどと同じくif文の中ではvalueはnullになり得ないが、先ほどと違って、演算子の種類(&amp;&amp;か||か)だけを見ればそれを判断可能になっている。
</p>
<pre>
void main(String[] args){
	let Map<string, int> map = new HashMap();
	map.put("A", 0);
	map.put("B", 1);
	map.put("C", 2);
	?int value = map.get("E");
	if(value != null &amp;&amp; false){
		int value2 = value;
	}
}
</pre>
<p>
このコードをコンパイルすると、今度は、何もエラーが出ずにコンパイルを通った。やはり、演算子の種類を見て判断しているようだ。
</p></div>

</div>

<div class="comment">

		<div class="caption">本日のツッコミ(全2件) [<a href="./?date=20040909#c">ツッコミを入れる</a>]</div>
		<div class="commentshort">
				<p><a href="./?date=20040909#c01"><span class="canchor">_</span></a>
				<span class="commentator">IKeJI</span>&nbsp;[それがどういう機能で、なぜエラーが出るのかを説明してくれた方がユーザーフレンドリーです。]</p>
				<p><a href="./?date=20040909#c02"><span class="canchor">_</span></a>
				<span class="commentator">mizu</span>&nbsp;[説明を追加してみました。]</p>
		</div>
</div>







		<div class="referer">
		本日のリンク元 | <a href="https://web.archive.org/web/20040912163845/http://www2.coins.tsukuba.ac.jp/~i021216/" title="http://www2.coins.tsukuba.ac.jp/~i021216/">14</a> | <a href="https://web.archive.org/web/20040912163845/http://ikejisoft.com/antenna/" title="http://ikejisoft.com/antenna/">9</a> | <a href="https://web.archive.org/web/20040912163845/http://www.coins.tsukuba.ac.jp/~i021216/" title="http://www.coins.tsukuba.ac.jp/~i021216/">4</a> | <a href="https://web.archive.org/web/20040912163845/http://www2.coins.tsukuba.ac.jp/~i021149/mirror/antenna/" title="http://www2.coins.tsukuba.ac.jp/~i021149/mirror/an...">3</a> | 
		</div>
</div>


	<hr class="sep">
	
<div class="day">
<h2><span class="date"><a href="./?date=20040910">2004-09-10</a></span> <span class="title"></span></h2>

<div class="body">

<div class="section">
<h3><a href="./?date=20040910#p01"><span class="sanchor">_</span></a> <a href="https://web.archive.org/web/20040912163845/http://pnuts.org/1.1/snapshot/20040908/doc.ja/lang.html#generator">Pnutsのジェネレータ</a></h3><p>
Pnuts1.1には、ジェネレータという機能がある。これは、関数定義の中に、'yield' 式を入れることで、その関数を呼び出したときに、関数が実行されるかわりにジェネレータを返すというもので、このジェネレータを、for文中で、</p>
<pre>
for(変数名 : ジェネレータ){
  ...
}
</pre>
<p>
のように使うと、yieldで評価した式の値が１つずつ変数に代入され、
その度に...が実行される。例えば、range()関数は、第1引数から
第2引数までの値を順にyieldするジェネレータで、次のようにして
使用する。
</p>
<pre>
for(i : range(1, 3)) print(i)
</pre>
<p>
実行結果は以下のようになる。
</p>
<pre>
C:\programs\pnuts&gt;pnuts range.pnut
123
</pre>
<p>
さて、このジェネレータ、Pnutsのライブラリでは、主にループ
のために使用されているが、何もループのためにしか使えないわけではない。例えば、<a href="https://web.archive.org/web/20040912163845/http://pnuts.org/~tomatsu/blog/index.pnut">PnutsBlog</a>では、ファイルを確実にcloseするために使う例が載っている。
</p>
<p>
また、他の応用例として、ソートの比較条件を指定するために使うことも考えられる。以下のコードは、ソートアルゴリズム中で、配列の要素をyieldした結果を元にソーティングを行うようにすることで、for文のブロックで比較条件を指定できるようにしている。
</p>
<pre>
function bubble_sort(lst){
	if(lst instanceof Object[]){
		size = lst.length
	}else{
		size = lst.size()
	}
	for(i = size - 1; i &gt;= 0; i--){
		for(j = 0; j &lt; i; j++){
			pair = $()
			pair.left = array[j]
			pair.right = array[j + 1]
			cmp_result = yield(pair)
			if(cmp_result &gt; 0){
				tmp = lst[j]
				lst[j] = lst[j + 1]
				lst[j + 1] = tmp
			}
		}
	}
}
<br>
array = [5, 3, 2, 4, 1]
for(pair : bubble_sort(array)) pair.left - pair.right
println(join(" ", array))
for(pair : bubble_sort(array)) pair.right - pair.left
println(join(" ", array))
</pre>
<p>
実行結果は、以下の通り。
</p>
<pre>
C:\programs\pnuts&gt;pnuts sort.pnut
1 2 3 4 5
5 4 3 2 1
<br>
</pre></div>

</div>

<div class="comment">

	<div class="caption">[<a href="./?date=20040910#c">ツッコミを入れる</a>]</div>
</div>







		<div class="referer">
		本日のリンク元 | <a href="https://web.archive.org/web/20040912163845/http://www2.coins.tsukuba.ac.jp/~i021216/" title="http://www2.coins.tsukuba.ac.jp/~i021216/">2</a> | <a href="https://web.archive.org/web/20040912163845/http://ikejisoft.com/antenna/" title="http://ikejisoft.com/antenna/">2</a> | <a href="https://web.archive.org/web/20040912163845/http://www.coins.tsukuba.ac.jp/~i021216/" title="http://www.coins.tsukuba.ac.jp/~i021216/">1</a> | <a href="https://web.archive.org/web/20040912163845/http://pnuts.org/~tomatsu/blog/index.pnut" title="http://pnuts.org/~tomatsu/blog/index.pnut">1</a> | 
		</div>
</div>


	<hr class="sep">
	
<div class="day">
<h2><span class="date"><a href="./?date=20040911">2004-09-11</a></span> <span class="title"></span></h2>

<div class="body">

<div class="section">
<h3><a href="./?date=20040911#p01"><span class="sanchor">_</span></a> [<a href="./?year=2004;month=3Q;category=Java">Java</a>]tiny C</h3><p>
　プログラミング言語処理の授業課題である、tiny Cのパーサを書く。といっても、tiny Cを書く課題は、まだ先の話だが。書くためのプログラミング言語は何でもいいと言っていたので、<a href="https://web.archive.org/web/20040912163845/https://javacc.dev.java.net/">JavaCC</a>を使うことにした。yaccを使ってもいいのだが、Cで書くのが面倒くさいので。
</p>
<p>
　JavaCCはLLなパーザジェネレータで、JJTreeというJavaCCに付属のプリプロセッサを使えば、構文木を自動生成することもできるが、今回はJJTreeを使わずに、JavaCCだけで書くことにした。その理由はいくつかあるが、JJTreeの生成する構文木の形式では、子ノードにアクセスするのにインデックスを使わなければならないというのが、一番大きなところだ。例えば、if文を表すノードから条件式を表すノードを取得するとき、
</p>
<pre>
node.getCondition()
</pre>
<p>
のような形で書けると嬉しいのだが、JJTreeで生成されたノードでは、
</p>
<pre>
node.jjtGetChild(0)
</pre>
<p>
のような形で書かなければいけない。これは、可読性の面からできれば避けたい。というわけで、JavaCCで書いてみると、さすがに文法が簡単なので、わりとすぐに文法定義ファイルは完成した。
</p>
<p>
ちなみに、作った文法定義ファイル(tinyc.jj)は<a href="https://web.archive.org/web/20040912163845/http://www.coins.tsukuba.ac.jp/~i021216/tinyc.jj">こちら。</a>
</p>
<p>
この文法定義ファイルには、構文木を構築するコードが入っていないが、それはこれから追加する予定。
</p></div>

</div>

<div class="comment">

	<div class="caption">[<a href="./?date=20040911#c">ツッコミを入れる</a>]</div>
</div>







		<div class="referer">
		本日のリンク元 | <a href="https://web.archive.org/web/20040912163845/http://www2.coins.tsukuba.ac.jp/~i021216/" title="http://www2.coins.tsukuba.ac.jp/~i021216/">8</a> | <a href="https://web.archive.org/web/20040912163845/http://ikejisoft.com/antenna/" title="http://ikejisoft.com/antenna/">3</a> | <a href="https://web.archive.org/web/20040912163845/http://pnuts.org/~tomatsu/blog/" title="http://pnuts.org/~tomatsu/blog/">2</a> | <a href="https://web.archive.org/web/20040912163845/http://www2.coins.tsukuba.ac.jp/~i021149/mirror/antenna/" title="http://www2.coins.tsukuba.ac.jp/~i021149/mirror/an...">1</a> | <a href="https://web.archive.org/web/20040912163845/http://www.coins.tsukuba.ac.jp/~i021216/" title="http://www.coins.tsukuba.ac.jp/~i021216/">1</a> | <a href="https://web.archive.org/web/20040912163845/http://pnuts.org/~tomatsu/blog/?category=pnuts" title="http://pnuts.org/~tomatsu/blog/?category=pnuts">1</a> | 
		</div>
</div>


	<hr class="sep">
	
<div class="day">
<h2><span class="date"><a href="./?date=20040912">2004-09-12</a></span> <span class="title"></span></h2>

<div class="body">

<div class="section">
<h3><a href="./?date=20040912#p01"><span class="sanchor">_</span></a> 続・ジェネレータ</h3><p>
Pnuts1.1のジェネレータを使って、foldlを実装してみる。コードは
以下の通り。
</p>
<pre>
function foldl(init, lst){
	result = init
	for(e : lst){
		pair = $()
		pair.x = result
		pair.y = e
		result = yield(pair)
	}
}
</pre>
<p>
実行するときは、以下のように書く。
</p>
<pre>
sum = for(p : foldl(0, [1,2,3,4,5,6])) p.x + p.y
println("sum:"+sum)
</pre>
<p>
実行結果は以下の通り。
</p>
<pre>
C:\programs\pnuts&gt;pnuts foldl.pnut
sum:21
</pre>
<p>
しかし、こんなものを使うくらいなら、普通に、<a href="https://web.archive.org/web/20040912163845/http://pnuts.org/1.1/snapshot/20040908/extensions/functional/doc.ja/index.html">functionalモジュール</a>のfoldlを使った方が良い気もする。こっちの利点といったら、少しだけタイプ量が減るくらいか。
</p></div><div class="section">
<h3><a href="./?date=20040912#p02"><span class="sanchor">_</span></a> サーバ入れ替え</h3><p>
友人が使っているサーバ用マシンが遅すぎるということで、家で余っていたマシンをあげることに。入れ替え後は大分速くなったようで、なにより。
</p></div>

</div>

<div class="comment">

	<div class="caption">[<a href="./?date=20040912#c">ツッコミを入れる</a>]</div>
</div>







		<div class="referer">
		本日のリンク元 | <a href="https://web.archive.org/web/20040912163845/http://ikejisoft.com/antenna/" title="http://ikejisoft.com/antenna/">7</a> | <a href="https://web.archive.org/web/20040912163845/http://www2.coins.tsukuba.ac.jp/~i021216/" title="http://www2.coins.tsukuba.ac.jp/~i021216/">3</a> | <a href="https://web.archive.org/web/20040912163845/http://www.coins.tsukuba.ac.jp/~i021216/" title="http://www.coins.tsukuba.ac.jp/~i021216/">1</a> | 
		</div>
</div>


	<hr class="sep">






<div class="footer">
Generated by <a href="https://web.archive.org/web/20040912163845/http://www.tdiary.org/">tDiary</a> version 2.0.0<br>
Powered by <a href="https://web.archive.org/web/20040912163845/http://www.ruby-lang.org/">Ruby</a> version 1.6.2
</div>
</body>
</html>
<!--
     FILE ARCHIVED ON 16:38:45 Sep 12, 2004 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 05:41:51 Nov 23, 2025.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  captures_list: 0.55
  exclusion.robots: 0.045
  exclusion.robots.policy: 0.034
  esindex: 0.009
  cdx.remote: 48.22
  LoadShardBlock: 417.109 (3)
  PetaboxLoader3.resolve: 1506.368 (4)
  PetaboxLoader3.datanode: 325.638 (4)
  load_resource: 1450.984
-->