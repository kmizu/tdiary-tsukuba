<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="ja-JP">
<head>

<script>window.RufflePlayer=window.RufflePlayer||{};window.RufflePlayer.config={"autoplay":"on","unmuteOverlay":"hidden","showSwfDownload":true};</script>

<script type="text/javascript">
    __wm.init("https://web.archive.org/web");
  __wm.wombat("http://www.coins.tsukuba.ac.jp:80/~i021216/diary/?date=200610","20070327065727","https://web.archive.org/","web","https://web-static.archive.org/_static/",
	      "1174978647");
</script>


<!-- End Wayback Rewrite JS Include -->

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="generator" content="tDiary 2.0.0">
	<meta http-equiv="Last-Modified" content="Tue, 06 Mar 2007 11:57:20 GMT">
	<meta http-equiv="Content-Script-Type" content="text/javascript; charset=UTF-8">
	<meta name="author" content="水島宏太">
	<link rev="made" href="mailto:hau51010{at}tree.odn.ne.jp">
	<link rel="index" title="トップ" href="http://www.coins.tsukuba.ac.jp/~i021216/">
	<link rel="start" title="最新" href="./">
	<meta http-equiv="content-style-type" content="text/css">
	<link rel="stylesheet" href="/web/20070327065727cs_/http://www.coins.tsukuba.ac.jp/~i021216/diary/theme/base.css" type="text/css" media="all">
	<link rel="stylesheet" href="/web/20070327065727cs_/http://www.coins.tsukuba.ac.jp/~i021216/diary/theme/another_blue/another_blue.css" title="another_blue" type="text/css" media="all">
	<title>Onion開発日記(2006-10)</title>
	
	<!--link rel="alternate" type="application/x-lirs" title="lirs" href="antenna.lirs"-->
	

<style>
    /* Modern Styling */
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans JP", Roboto, "Helvetica Neue", Arial, sans-serif;
        line-height: 1.7;
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        color: #333;
    }
    
    h1 {
        color: #2c3e50;
        border-bottom: 3px solid #3498db;
        padding-bottom: 12px;
        font-size: 2em;
        margin-top: 0;
    }
    
    h2 {
        color: #34495e;
        border-left: 4px solid #3498db;
        padding-left: 12px;
        margin-top: 30px;
    }
    
    h3 {
        color: #555;
        margin-top: 24px;
    }
    
    .day {
        background: white;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 24px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .day:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    
    .section {
        margin: 16px 0;
        padding: 12px;
        border-left: 3px solid #e8e8e8;
    }
    
    .date {
        color: #3498db;
        font-weight: 600;
    }
    
    .title {
        color: #2c3e50;
        font-size: 1.3em;
    }
    
    a {
        color: #3498db;
        text-decoration: none;
        transition: color 0.2s;
    }
    
    a:hover {
        color: #2980b9;
        text-decoration: underline;
    }
    
    pre {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 6px;
        padding: 16px;
        overflow-x: auto;
        font-size: 0.9em;
    }
    
    code {
        background: #f8f9fa;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: 'Courier New', Courier, monospace;
    }
    
    .comment {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 16px;
        margin-top: 20px;
    }
    
    .adminmenu, .calendar, .todo {
        background: white;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 16px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .referer {
        font-size: 0.85em;
        color: #7f8c8d;
        margin-top: 16px;
        padding-top: 12px;
        border-top: 1px solid #e8e8e8;
    }
    
    /* Web Archive ツールバーを非表示 */
    #wm-ipp-base, #wm-ipp, #donato {
        display: none !important;
    }
    
    hr.sep {
        border: none;
        border-top: 2px solid #e8e8e8;
        margin: 30px 0;
    }
</style>

</head>
<body>


<div class="adminmenu">
<span class="adminmenu"><a href="https://web.archive.org/web/20070327065727/http://www.coins.tsukuba.ac.jp/~i021216/">トップ</a></span>
<span class="adminmenu"><a href="./">最新</a></span>
<span class="adminmenu"><a href="update.rb">追記</a></span>
</div>
<h1>Onion開発日記</h1>
<div class="calendar">
<div class="year">2004|<a href="./?date=200409">09</a>|<a href="./?date=200410">10</a>|<a href="./?date=200411">11</a>|<a href="./?date=200412">12</a>|</div>
<div class="year">2005|<a href="./?date=200501">01</a>|<a href="./?date=200502">02</a>|<a href="./?date=200503">03</a>|<a href="./?date=200504">04</a>|<a href="./?date=200505">05</a>|<a href="./?date=200506">06</a>|<a href="./?date=200507">07</a>|<a href="./?date=200508">08</a>|<a href="./?date=200509">09</a>|<a href="./?date=200510">10</a>|<a href="./?date=200511">11</a>|<a href="./?date=200512">12</a>|</div>
<div class="year">2006|<a href="./?date=200601">01</a>|<a href="./?date=200602">02</a>|<a href="./?date=200603">03</a>|<a href="./?date=200604">04</a>|<a href="./?date=200605">05</a>|<a href="./?date=200606">06</a>|<a href="./?date=200607">07</a>|<a href="./?date=200608">08</a>|<a href="./?date=200609">09</a>|<a href="./?date=200610">10</a>|<a href="./?date=200611">11</a>|<a href="./?date=200612">12</a>|</div>
<div class="year">2007|<a href="./?date=200701">01</a>|<a href="./?date=200702">02</a>|<a href="./?date=200703">03</a>|</div>
</div>
<div class="todo">
	<div class="todo-title">
		<p>ToDo:</p>
	</div>
	<div class="todo-body">
<ul>
</ul>

	</div>
</div>


<hr class="sep">


	
<div class="day">
<h2><span class="date"><a href="./?date=20061017">2006-10-17</a></span> <span class="title"></span></h2>

<div class="body">

<div class="section">
<h3><a href="./?date=20061017#p01"><span class="sanchor">_</span></a> [<a href="./?year=2006;month=4Q;category=Nemerle">Nemerle</a>]Nemerleはじめました</h3><p>
以前からドキュメントやPaper読んだりして、言語仕様の概要についてはある程度調べていたが、処理系自体はほとんど触ったことが無かったので、これを機会に触ってみることにする。とはいえ、普通のプログラムを書いてもつまらんので、Nemerleの特徴であるマクロを使ったプログラムを中心に書いていこうと思う。
</p>
<h3>階乗計算</h3>
<p>
まずは、C++などのメタプログラミングの話になると必ずと言っていい程でてくる階乗計算計算の例。
</p>
<p><strong>fact.n</strong></p>
<pre>
macro fact(n :int){
  def f(n){
  | 0 =&gt; 1
  | _ =&gt; n * f(n - 1)
  }
  &lt;[ $(f(n) :int) ]&gt;
}
</pre>
<p>
<strong>macro</strong>キーワードでマクロを定義し、それに続いてマクロ名としてfactを、仮引数としてnを指定している。その後に:intとあるのは、このマクロが引数として整数定数を取ることを表している。
</p>
<p>
本体の方では、まず普通に階乗を計算する関数fをパターンマッチを使って定義し、それをマクロ中で呼び出すことで、コンパイル時計算を実現している。ここで、&lt;[]&gt;はLisp系言語のquoteに相当し、$()はunquoteに相当する。
</p>
<p>
このマクロを使用するコードは次のようになる。
</p>
<p><strong>use_fact.n</strong>
<pre>
using System;
Console.WriteLine("fact({0}) = {1}", 5, fact(3));
</pre>
<p>
これで一応コンパイル時に階乗が計算できているわけだが、これだけだと、実際にコンパイル時に計算されているかどうかがわからない。そこで、実際にコンパイル時に計算した階乗の値を印字するようにしてみる。今度は、コードは次のようになる。
</p>
<p><strong>fact2.n</strong></p>
<pre>
macro fact(n :int){
  def f(n){
  | 0 =&gt; 1
  | _ =&gt; n * f(n - 1)
  }
  def r = f(n);
  Console.WriteLine("fact({0}) = {1}", n, r);
  &lt;[ $(r :int) ]&gt;
}
</pre>
<p>
上のuse_fact.nをこのマクロを使ってコンパイルすると、コンパイル時に
</p>
<pre>
fact(5) = 120
</pre>
<p>
と表示される。
</p>
<p>
さて、これだけでコンパイル時に階乗を計算することはできているわけだが、このマクロには、fact(n)のように変数を渡してマクロを呼び出すとコンパイルエラーになってしまうという問題がある。そこで、渡されたのが定数でなければ実行時に計算するように改良してみる。
</p>
<p><strong>fact3.n</strong></p>
<pre>
public class Fact {
  public static f(n :int) :int {
  | 0 =&gt; 1
  | n =&gt; n * f(n - 1)
  }
}
macro fact(n){
  match(n){
  | $(m :int) =&gt; { 
      def r = Fact.f(m);
      Console.WriteLine("fact({0}) = {1}", m, r);
      &lt;[ $(r :int) ]&gt;
    }
  | _ =&gt; &lt;[ Fact.f($n) ]&gt;
}
</pre>
<p>
今度はわざわざクラスを定義して、その中のstatic関数を間接的に呼び出すようになっているが、これは階乗を実行時に計算するパターンのときに、マクロの内部で定義した関数を呼び出す形式に展開するようになっていると、マクロの呼び出し側で関数名が見つからずに、コンパイルエラーになるためだ。
</p>
<p>
このプログラムで、ちゃんと変数を引数に取るようなマクロの呼び出しが実行時に計算されることを確かめるために、次のようなサンプルプログラムを書いた。
</p>
<p><strong>use_fact3.n</strong></p>
<pre>
using System;
Console.WriteLine("fact({0}) = {1}", 5, fact(5));
def n = 10;
Console.WriteLine("fact({0}) = {1}", n, fact(n));
</pre>
<p>
このプログラムをコンパイルすると、<strong>コンパイル時には</strong>
</p>
<pre>
fact(5) = 120
</pre>
<p>
とだけ表示され、fact(n)の方は実行時に計算されていることがわかる。
</p>
<h3>正規表現リテラル</h3>
<p>
階乗のコンパイル時計算だけだとアレなので、今度はもうちょっと実用的に役に立ちそうなマクロを作ってみる。作るのは、コンパイル時に正規表現が正しいかどうかチェックして、正しく無い場合コンパイルエラーにするマクロ。
</p>
<p>
正規表現が正しいかどうかのチェックは、自前でやることもできるが、既に.NET Frameworkに正規表現ライブラリがあるのでそれを利用して、サクっと作ってしまうことにする。以下がそのコード。
</p>
<p><strong>pattern.n</strong<>
<pre>
using System.Text.RegularExpressions;
macro pattern(s){
  match(s){
  | &lt;[ ($s_ :string) ]&gt; =&gt; { _ = Regex(s_); &lt;[ Regex($s) ]&gt; }
  | _ =&gt; &lt;[ Regex($s) ]&gt;
}
</pre>
<p>
コンストラクタRegexは引数に渡した文字列が正しく無い場合、ArgumentExeptionをthrowするので、マクロに渡した文字列リテラル
が正規表現として正しく無い場合、マクロ内でArgumentExceptionがthrowされ、その結果、コンパイルエラーになる。
</p>
<p>
このマクロを利用したコードは、次のような感じになる。
</p>
<p><strong>use_pattern.n</strong></p>
<pre>
def pat = pattern("***");
</pre>
<p>
このコードをコンパイルすると、コンパイル時にArgumentExceptionが発生し、コンパイルエラーになる。
</p></div>

</div>

<div class="comment">

		<div class="caption">本日のツッコミ(全3件) [<a href="./?date=20061017#c">ツッコミを入れる</a>]</div>
		<div class="commentshort">
				<p><a href="./?date=20061017#c01"><span class="canchor">_</span></a>
				<span class="commentator">wqj4lf5@search.com</span>&nbsp;[funny ringtones  ]</p>
				<p><a href="./?date=20061017#c02"><span class="canchor">_</span></a>
				<span class="commentator">Masd Austy</span>&nbsp;[Hut is big  ]</p>
				<p><a href="./?date=20061017#c03"><span class="canchor">_</span></a>
				<span class="commentator">ifouapr@lycos.com</span>&nbsp;[funny ringtones]</p>
		</div>
</div>







		<div class="referer">
		本日のリンク元 | <a href="https://web.archive.org/web/20070327065727/http://www.nastyhost.com/members/veselis/" title="http://www.nastyhost.com/members/veselis/">704</a> | <a href="https://web.archive.org/web/20070327065727/http://www.nastyhost.com/members/sovsem/" title="http://www.nastyhost.com/members/sovsem/">355</a> | <a href="https://web.archive.org/web/20070327065727/http://www.hostones.com/websites/amateurs/zaebun/" title="http://www.hostones.com/websites/amateurs/zaebun/">261</a> | <a href="https://web.archive.org/web/20070327065727/http://www.hostones.com/websites/fetish/zamnoy/" title="http://www.hostones.com/websites/fetish/zamnoy/">85</a> | <a href="https://web.archive.org/web/20070327065727/http://alohakun.blog7.fc2.com/" title="http://alohakun.blog7.fc2.com/">28</a> | <a href="https://web.archive.org/web/20070327065727/http://www.coins.tsukuba.ac.jp/" title="http://www.coins.tsukuba.ac.jp">17</a> | <a href="https://web.archive.org/web/20070327065727/http://www.google.es/search?sourceid=navclient-ff&amp;ie=UTF-8&amp;rls=GGGL,GGGL:2006-36,GGGL:es&amp;q=www.tutto%3Agratis+ESPANOL" title="http://www.google.es/search?sourceid=navclient-ff&amp;...">12</a> | <a href="https://web.archive.org/web/20070327065727/http://search.msn.it/results.aspx?q=universitarie+per+appuntamenti+sexdi&amp;FORM=MSNH&amp;CP=1252&amp;srch_type=0" title="http://search.msn.it/results.aspx?q=universitarie ...">12</a> | <a href="https://web.archive.org/web/20070327065727/http://www.google.com.pe/search?hl=es&amp;q=www.peruanitas.com&amp;meta=" title="http://www.google.com.pe/search?hl=es&amp;q=www.peruan...">10</a> | <a href="https://web.archive.org/web/20070327065727/http://www.coins.tsukuba.ac.jp/~hdk/hina/" title="http://www.coins.tsukuba.ac.jp/~hdk/hina/">10</a> | <a href="./?date=20061017#t">TrackBack(0)</a>
		</div>
</div>


	<hr class="sep">
	
<div class="day">
<h2><span class="date"><a href="./?date=20061018">2006-10-18</a></span> <span class="title"></span></h2>

<div class="body">

<div class="section">
<h3><a href="./?date=20061018#p01"><span class="sanchor">_</span></a> [<a href="./?year=2006;month=4Q;category=Nemerle">Nemerle</a>]マクロ内で型チェックをする方法</h3><p>
Nemerleのマクロ内で式の型チェックをする方法がわからない…。
<a href="https://web.archive.org/web/20070327065727/http://nemerle.org/metaprogramming.pdf">Meta-programming in Nemerle</a>の例では、TypedExprというのを使って、式 -&gt; 型付き式に変換してるんだが、手元のNemerleコンパイラでは使えないし。
</p>
<p>
追記：どうやらNemerle.MacrosネームスペースのImplicitCTX()マクロを呼び出すと、式に型を付けるために使えるTyperクラスのオブジェクトが取得できるっぽい。Typerクラスのインスタンスが取得できたら、あとはTyper#TypeExpr(PExpr)を使って、式に型付けを行うことができるようだ。<a href="https://web.archive.org/web/20070327065727/http://nemerle.org/Macro_tips">参考： Macro tips</a>
</p></div>

</div>

<div class="comment">

		<div class="caption">本日のツッコミ(全1件) [<a href="./?date=20061018#c">ツッコミを入れる</a>]</div>
		<div class="commentshort">
				<p><a href="./?date=20061018#c01"><span class="canchor">_</span></a>
				<span class="commentator">fugcpqm@ebay.com</span>&nbsp;[funny ringtones  ]</p>
		</div>
</div>







		<div class="referer">
		本日のリンク元 | <a href="https://web.archive.org/web/20070327065727/http://www2.xfreehosting.com/fetish/zanyato/" title="http://www2.xfreehosting.com/fetish/zanyato/">1052</a> | <a href="https://web.archive.org/web/20070327065727/http://prodaza.porkyhost.com/" title="http://prodaza.porkyhost.com/">764</a> | <a href="https://web.archive.org/web/20070327065727/http://vsemoe.sultryserver.com/" title="http://vsemoe.sultryserver.com/">712</a> | <a href="https://web.archive.org/web/20070327065727/http://glazam.sultryserver.com/" title="http://glazam.sultryserver.com/">702</a> | <a href="https://web.archive.org/web/20070327065727/http://www2.xfreehosting.com/hardcore/navsegda/" title="http://www2.xfreehosting.com/hardcore/navsegda/">697</a> | <a href="https://web.archive.org/web/20070327065727/http://zakovka.porkyhost.com/" title="http://zakovka.porkyhost.com/">693</a> | <a href="https://web.archive.org/web/20070327065727/http://www.hostones.com/websites/fetish/zamnoy/" title="http://www.hostones.com/websites/fetish/zamnoy/">604</a> | <a href="https://web.archive.org/web/20070327065727/http://www.hostones.com/websites/amateurs/zaebun/" title="http://www.hostones.com/websites/amateurs/zaebun/">532</a> | <a href="https://web.archive.org/web/20070327065727/http://www.nastyhost.com/members/sovsem/" title="http://www.nastyhost.com/members/sovsem/">353</a> | <a href="https://web.archive.org/web/20070327065727/http://www.google.com.mx/search?hl=es&amp;q=www.pompis.com.mx&amp;meta=" title="http://www.google.com.mx/search?hl=es&amp;q=www.pompis...">106</a> | <a href="./?date=20061018#t">TrackBack(0)</a>
		</div>
</div>


	<hr class="sep">
	
<div class="day">
<h2><span class="date"><a href="./?date=20061019">2006-10-19</a></span> <span class="title"></span></h2>

<div class="body">

<div class="section">
<h3><a href="./?date=20061019#p01"><span class="sanchor">_</span></a> [<a href="./?year=2006;month=4Q;category=%BC%F8%B6%C8">授業</a>]システム情報工学セミナー</h3><p>
シス情セミナーの教室変更があったのをすっかり忘れていたおかげで、授業に出席し損なってしまった。おかげで来週までに欠席レポート書くはめにorz
</p></div><div class="section">
<h3><a href="./?date=20061019#p02"><span class="sanchor">_</span></a> [<a href="./?year=2006;month=4Q;category=Java">Java</a>]ObjectInputStreamでカスタムクラスローダを使う</h3><p>
ObjectInputStream#readObject()はデフォルトでは、system classloaderを使ってクラスをロードしているようなのだが、自前のクラスローダなどを使ってクラスを読み込めないと困る事態が起きてしまった。
</p>
<p>
なんとかObjectInputStream#readObject()のときに、カスタムクラスローダを使えないか調べていたところ、ObjectInputStreamをサブクラス化して、
</p>
<pre>
Class&lt;?&gt; ObjectInputStream#resolveClass(ObjectStreamClass)
</pre>
<p>
をオーバーライドしてやれば良いらしい。参考： <a href="https://web.archive.org/web/20070327065727/http://forum.java.sun.com/thread.jspa?threadID=468339&amp;messageID=2159594">
Can't use custom ClassLoader with ObjectInputStream
</a>
<p>
で、こんな感じでカレントスレッドのコンテキストクラスローダを使うようにすることで、ObjectInputStream#readObject()をうまく動作させることができた。
</p>
<pre>
package jp.gr.java_conf.mizu.javaflow.servlet;
<br>
import java.io.IOException;
import java.io.InputStream;
import java.io.ObjectInputStream;
import java.io.ObjectStreamClass;
<br>
public class CustomObjectInputStream extends ObjectInputStream {
  public CustomObjectInputStream(InputStream in) throws IOException {
    super(in);
  }
<br>
  @Override
  protected Class&lt;?&gt; resolveClass(ObjectStreamClass desc) throws IOException, ClassNotFoundException {
    try {
      return Class.forName(desc.getName(), true, Thread.currentThread().getContextClassLoader());
    }catch(ClassNotFoundException e){
      return super.resolveClass(desc);
    }
  }  
}
</pre></div>

</div>

<div class="comment">

	<div class="caption">[<a href="./?date=20061019#c">ツッコミを入れる</a>]</div>
</div>







		<div class="referer">
		本日のリンク元 | <a href="https://web.archive.org/web/20070327065727/http://www.nastyhost.com/members/veselis/" title="http://www.nastyhost.com/members/veselis/">1402</a> | <a href="https://web.archive.org/web/20070327065727/http://www2.xfreehosting.com/fetish/zanyato/" title="http://www2.xfreehosting.com/fetish/zanyato/">1049</a> | <a href="https://web.archive.org/web/20070327065727/http://www.nastyhost.com/members/sovsem/" title="http://www.nastyhost.com/members/sovsem/">1043</a> | <a href="https://web.archive.org/web/20070327065727/http://www.hostones.com/websites/fetish/zamnoy/" title="http://www.hostones.com/websites/fetish/zamnoy/">950</a> | <a href="https://web.archive.org/web/20070327065727/http://www.hostones.com/websites/amateurs/zaebun/" title="http://www.hostones.com/websites/amateurs/zaebun/">860</a> | <a href="https://web.archive.org/web/20070327065727/http://prodaza.porkyhost.com/" title="http://prodaza.porkyhost.com/">765</a> | <a href="https://web.archive.org/web/20070327065727/http://www2.xfreehosting.com/hardcore/navsegda/" title="http://www2.xfreehosting.com/hardcore/navsegda/">700</a> | <a href="https://web.archive.org/web/20070327065727/http://glazam.sultryserver.com/" title="http://glazam.sultryserver.com/">687</a> | <a href="https://web.archive.org/web/20070327065727/http://zakovka.porkyhost.com/" title="http://zakovka.porkyhost.com/">686</a> | <a href="https://web.archive.org/web/20070327065727/http://vsemoe.sultryserver.com/" title="http://vsemoe.sultryserver.com/">676</a> | <a href="./?date=20061019#t">TrackBack(0)</a>
		</div>
</div>


	<hr class="sep">
	
<div class="day">
<h2><span class="date"><a href="./?date=20061021">2006-10-21</a></span> <span class="title"></span></h2>

<div class="body">

<div class="section">
<h3><a href="./?date=20061021#p01"><span class="sanchor">_</span></a> [<a href="./?year=2006;month=4Q;category=Java">Java</a>][<a href="./?year=2006;month=4Q;category=Ruby">Ruby</a>]Ruby流のブロックをJavaで実現するときの問題点</h3><p>
<a href="https://web.archive.org/web/20070327065727/http://cappuccino.jp/keisuken/logbook/20061021.html#c">航海日誌</a>より引用：
</p>
<blockquote>
Ruby流のブロックをパターンで
というのは何故議論されないのかな．
一応クロージャを導入しなくとも，anonymous classでできますよ(ほんのちょっと冗長だけど)．前に書いたソースを再掲すると，
</blockquote>
<p>
現在のJavaでもanonymous classでRubyのブロック相当のものを実現できるというのは賛成で特に異論は無いんですが、現在のJavaの言語仕様の範囲ではchecked exceptionに対して透過的なブロックを作るのが難しいという問題点があるんじゃないでしょうか。
</p>
<p>
例えば、keisukenさんのInputStreamBlockだと、run()の中からIOException以外のExceptionを投げることができません。runのthrows節にExceptionを追加するか、RuntimeExceptionにラップしてthrowするという解決策は考えられますが、それだと今度はchecked exceptionの利点を殺してしまうことになりかねません。あるいは、おっしゃられるように型パラメータを使って、
</p>
<pre>
import java.io.*;
public class Test {
  static abstract class InputStreamBlock&lt;E extends Exception&gt; {
    InputStream in;
    public InputStreamBlock(InputStream in) throws IOException, E {
      this.in = in;
      try {
        run();
      } finally {
        in.close();
      }
    }
    abstract void run() throws IOException, E;
  }
  ...
}
</pre>
<p>
のようにすることで、IOException以外の種類の例外を投げられるようになりますが、これではthrowsできるcheced exceptionが1種類に限定されてしまいます。実用上は1種類だけでもなんとかなるケースが多いとは思いますが、リフレクション系APIなど、いくつもの種類の例外を投げるメソッドを使った場合に困ることもあるのではないかと思います。
</p>
<p>
ちなみに、Neal Gafterのブログのエントリ<a href="https://web.archive.org/web/20070327065727/http://gafter.blogspot.com/2006/09/nominal-closures-for-java-version-02.html">Nominal Closures for Java (version 0.2)</a>中の
「5. Exception type parameters」で、その問題に
対する解決策が議論されています。
</p></div>

</div>

<div class="comment">

		<div class="caption">本日のツッコミ(全3件) [<a href="./?date=20061021#c">ツッコミを入れる</a>]</div>
		<div class="commentshort">
				<p><a href="./?date=20061021#c01"><span class="canchor">_</span></a>
				<span class="commentator">keisuken</span>&nbsp;[「Ruby流のブロックをJavaで実現するときの問題点の例外の件」についてなんですが，実はGenericsだけではだ..]</p>
				<p><a href="./?date=20061021#c02"><span class="canchor">_</span></a>
				<span class="commentator">みずしま</span>&nbsp;[たぶんわかっておられると思うのですが、念のため補足しておくと、Nominal Closures for Javaの話..]</p>
				<p><a href="./?date=20061021#c03"><span class="canchor">_</span></a>
				<span class="commentator">keisuken</span>&nbsp;[みずしまさん: &gt; Nominal Closures for Javaの話は、Dolphinでそういうのを入れる事を..]</p>
		</div>
</div>







		<div class="referer">
		本日のリンク元 | <a href="https://web.archive.org/web/20070327065727/http://www2.xfreehosting.com/fetish/zanyato/" title="http://www2.xfreehosting.com/fetish/zanyato/">3121</a> | <a href="https://web.archive.org/web/20070327065727/http://prodaza.porkyhost.com/" title="http://prodaza.porkyhost.com/">2319</a> | <a href="https://web.archive.org/web/20070327065727/http://vsemoe.sultryserver.com/" title="http://vsemoe.sultryserver.com/">2221</a> | <a href="https://web.archive.org/web/20070327065727/http://www.nastyhost.com/members/sovsem/" title="http://www.nastyhost.com/members/sovsem/">2192</a> | <a href="https://web.archive.org/web/20070327065727/http://www.nastyhost.com/members/veselis/" title="http://www.nastyhost.com/members/veselis/">2186</a> | <a href="https://web.archive.org/web/20070327065727/http://zakovka.porkyhost.com/" title="http://zakovka.porkyhost.com/">2131</a> | <a href="https://web.archive.org/web/20070327065727/http://www2.xfreehosting.com/hardcore/navsegda/" title="http://www2.xfreehosting.com/hardcore/navsegda/">2089</a> | <a href="https://web.archive.org/web/20070327065727/http://www.hostones.com/websites/amateurs/zaebun/" title="http://www.hostones.com/websites/amateurs/zaebun/">1900</a> | <a href="https://web.archive.org/web/20070327065727/http://www.hostones.com/websites/fetish/zamnoy/" title="http://www.hostones.com/websites/fetish/zamnoy/">1886</a> | <a href="https://web.archive.org/web/20070327065727/http://glazam.sultryserver.com/" title="http://glazam.sultryserver.com/">1739</a> | <a href="./?date=20061021#t">TrackBack(0)</a>
		</div>
</div>


	<hr class="sep">
	
<div class="day">
<h2><span class="date"><a href="./?date=20061027">2006-10-27</a></span> <span class="title"></span></h2>

<div class="body">

<div class="section">
<h3><a href="./?date=20061027#p01"><span class="sanchor">_</span></a> [<a href="./?year=2006;month=4Q;category=%B8%A6%B5%E6">研究</a>]ベンチマーク</h3><p>
4年生以降になってたぶん初めて、自分の研究のためにベンチマークを取った。しかし、Javaでベンチマークを取るのは難しい。うまくやらないと、動作途中にJITコンパイラの最適化が始まったりして、入力の長さと性能の関係がわかりにくくなる。特に今回は、入力が比較的短い場合について測定したので、なおさらだ。結局、-Xintオプションでインタプリタモードにしてベンチマークを取ってしまったorz
</p></div><div class="section">
<h3><a href="./?date=20061027#p02"><span class="sanchor">_</span></a> [<a href="./?year=2006;month=4Q;category=Nemerle">Nemerle</a>]言語紹介</h3><p>
友人が企画した(今のところ)学内のみのイベント<a href="https://web.archive.org/web/20070327065727/http://www.mirai-kaigi.com/kaigi/001/#extended"><strong>未来会議</strong></a>で、Nemerleについて紹介する発表をしてきた。
</p>
<p>
自分で言うのもなんだが、誰を対象にした発表なんだかよくわからないものになってしまった。関数型言語とかマクロについてあまり知らない人を対象にするなら、基本的な部分についてもっとちゃんと説明すべきだったし、知っている人を対象にするならその辺は、はしょってしまうべきだった。結局、どっちつかずになってしまった。
</p></div>

</div>

<div class="comment">

		<div class="caption">本日のツッコミ(全1件) [<a href="./?date=20061027#c">ツッコミを入れる</a>]</div>
		<div class="commentshort">
				<p><a href="./?date=20061027#c01"><span class="canchor">_</span></a>
				<span class="commentator">らふにん</span>&nbsp;[そういう人たちが混在する場でしたからねぇ。 といっても、そこら辺がわからない方が少数派だったと思いますが。  ]</p>
		</div>
</div>







		<div class="referer">
		本日のリンク元 | <a href="https://web.archive.org/web/20070327065727/http://www.google.com/search?hl=en&amp;q=CHICA+PUTA++MASTURBANDOS&amp;btnG=Google+Search" title="google検索(CHICA PUTA  MASTURBANDOS)">42</a> | <a href="https://web.archive.org/web/20070327065727/http://www.google.com/search?q=www.adilia.com" title="google検索(www.adilia.com)">34</a> | <a href="https://web.archive.org/web/20070327065727/http://aolsearch.aol.co.uk/web?query=www.adilia.com&amp;restrict=wholeweb&amp;isinit=true&amp;invocationType=uk_wssilver_Cl&amp;avtype=" title="http://aolsearch.aol.co.uk/web?query=www.adilia.co...">18</a> | <a href="https://web.archive.org/web/20070327065727/http://www.google.com.tr/search?hl=tr&amp;q=www.adilia.com&amp;btnG=Google%27da+Ara&amp;meta=" title="http://www.google.com.tr/search?hl=tr&amp;q=www.adilia...">17</a> | <a href="https://web.archive.org/web/20070327065727/http://search.yahoo.co.jp/search?p=polno+tube&amp;fr=top_v2&amp;tid=top_v2&amp;ei=euc-jp&amp;search.x=1" title="http://search.yahoo.co.jp/search?p=polno tube&amp;fr=t...">15</a> | <a href="https://web.archive.org/web/20070327065727/http://search.yahoo.co.jp/search?p=polno+tube&amp;ei=UTF-8&amp;fr=top_v2&amp;x=wrt&amp;meta=vc%3D" title="http://search.yahoo.co.jp/search?p=polno tube&amp;ei=U...">13</a> | <a href="https://web.archive.org/web/20070327065727/http://www.google.com.tr/search?hl=tr&amp;q=www.adilia.com&amp;meta=" title="http://www.google.com.tr/search?hl=tr&amp;q=www.adilia...">11</a> | <a href="https://web.archive.org/web/20070327065727/http://www.pop.com.br/barra.php?url=http://www2.coins.tsukuba.ac.jp/~i021216/diary/?date=20061027" title="http://www.pop.com.br/barra.php?url=http://www2.co...">10</a> | <a href="https://web.archive.org/web/20070327065727/http://search.yahoo.co.jp/search?p=polno+tube&amp;ei=UTF-8&amp;fr=top_v2&amp;x=wrt" title="http://search.yahoo.co.jp/search?p=polno tube&amp;ei=U...">10</a> | <a href="https://web.archive.org/web/20070327065727/http://cgi.search.biglobe.ne.jp/cgi-bin/search2-b?search=%8C%9F%8D%F5&amp;q=Polno+Tube" title="BIGLOBE検索(Polno Tube)">8</a> | <a href="./?date=20061027#t">TrackBack(0)</a>
		</div>
</div>


	<hr class="sep">
	
<div class="day">
<h2><span class="date"><a href="./?date=20061028">2006-10-28</a></span> <span class="title"></span></h2>

<div class="body">

<div class="section">
<h3><a href="./?date=20061028#p01"><span class="sanchor">_</span></a> [<a href="./?year=2006;month=4Q;category=Java">Java</a>]JavaでGenericなVisitor</h3><p>
絶対誰かが既にやってそうだけど、あえてやってみる。
</p>
<p>
JavaでVisitorパターンを使う場合の欠点として、
</p>
<ul>
<li>visitメソッドに渡すコンテキスト情報を表す引数の型を、Visitorクラスを作るときに決定しなければならないため、個々のVisitorのサブクラスごとに異なる型の情報を渡すのが面倒</li>
<li>visitメソッドの返り値の型をVisitorクラスを作るときに決定しなければならないため、個々のVisitorのサブクラスごとに異なる型の値を返したり、個々のサブクラスでvisitメソッドごとに異なる型の値を返したりできない</li>
</ul>
<p>
というのがあったのだが、Java 5にはせっかくGenericsがあるんだから、この辺をもっとうまく書けるんじゃなかろうかということで、作ってみた。要点は、次の３つ。
</p>
<ul>
<li>Visitorインタフェースをvisitメソッドに渡すコンテキスト情報の型でパラメータ化する</li>
<li>個々のvisitメソッドは、Visitorインタフェースで宣言する段階では、
返り値の型をパラメータ化した多相メソッドとして宣言しておく。
</li>
<li>visit対象のオブジェクトのクラスでは、acceptを返り値の型とコンテキスト情報の型でパラメータ化した多相メソッドとして宣言しておく。
</li>
</ul>
<p>
実際に作ってみたソースは以下。Visitorインタフェースでは、visitメソッドの返り値の具体的な型もコンテキスト情報の型も指定せず、実際に処理を行うVisitorの実装クラスCalculatorで個々のvisitメソッドの型とコンテキスト情報の型を指定できている。
</p>
<p>
しかし、この方法には欠点がある。acceptメソッドが返す値の型はVisitorの実装クラスのvisitメソッドの型に依存しているため、acceptの呼び出し結果の値を入れる変数の型を間違えると、実行時エラーになってしまうのだ。つまり、この方法を使って作ったVisitorは型安全では無くなってしまう。
</p>
<p>
ただ、コンパイラはvisitメソッドの実装箇所で、型安全じゃないという旨の警告メッセージを出してくれるので、acceptを呼び出す部分で注意さえしていれば、わりと使えるテクニックなのではないかと思う。
</p>
<pre>
import java.util.*;
<br>
public class Main {
  public static void main(String[] args){
    Exp exp = new BlkExp(
      new SetExp("x", new IntExp(2)),
      new SetExp("y", new IntExp(3)),
      new SetExp("z", new IntExp(4)),
      new MulExp(new AddExp(new VarExp("x"), new VarExp("y")), new VarExp("z"))
    );
    Integer result = exp.accept(new Calculator(), new Env());
    //String s = exp.accept(new Calculator(), new Env()); と書くと実行時にClassCastException発生
    System.out.printf("{ x = 2; y = 3; z = 4; (x + y) * z } = %d%n", result);
  }
}
<br>
interface Visitor&lt;C&gt; {
  &lt;R&gt; R visit(AddExp e, C c);
  &lt;R&gt; R visit(SubExp e, C c);
  &lt;R&gt; R visit(MulExp e, C c);
  &lt;R&gt; R visit(DivExp e, C c);
  &lt;R&gt; R visit(IntExp e, C c);
  &lt;R&gt; R visit(VarExp e, C c);
  &lt;R&gt; R visit(SetExp e, C c);
  &lt;R&gt; R visit(BlkExp e, C C);
}
<br>
class Calculator implements Visitor&lt;Env&gt; {
  public Integer visit(AddExp e, Env env){
    Integer lval = e.left.accept(this, env);
    Integer rval = e.right.accept(this, env);
    return lval + rval;
  }
  public Integer visit(SubExp e, Env env){
    Integer lval = e.left.accept(this, env);
    Integer rval = e.right.accept(this, env);
    return lval - rval;
  }
  public Integer visit(MulExp e, Env env){
    Integer lval = e.left.accept(this, env);
    Integer rval = e.right.accept(this, env);
    return lval * rval;
  }
  public Integer visit(DivExp e, Env env){
    Integer lval = e.left.accept(this, env);
    Integer rval = e.right.accept(this, env);
    return lval / rval;
  }
  public Integer visit(IntExp e, Env env){
    return e.value;
  }
  public Integer visit(VarExp e, Env env){
    Integer value = env.lookup(e.name);
    if(value == null) throw new RuntimeException("undefined variable '" + e.name + "'");
    return value;
  }
  public Integer visit(SetExp e, Env env){
    Integer value = e.exp.accept(this, env);
    env.set(e.name, value);
    return value;
  }
  public Integer visit(BlkExp e, Env env){
    Integer value = 0;
    for(Exp element : e.exps) value = element.accept(this, env);
    return value;
  }
}
<br>
class Env {
  private Map&lt;String, Integer&gt; table = new HashMap&lt;String, Integer&gt;();
  Integer lookup(String name){ 
    return table.get(name); 
  }
  void set(String name, Integer value) {
    table.put(name, value);
  }
}
<br>
abstract class Exp {
  abstract &lt;R, C&gt; R accept(Visitor&lt;C&gt; v, C c);
}
<br>
abstract class BinExp extends Exp {
  final Exp left, right;
  BinExp(Exp left, Exp right) {
    this.left  = left;
    this.right = right;
  }
}
<br>
class AddExp extends BinExp {
  AddExp(Exp left, Exp right){ super(left, right); }
  &lt;R, C&gt; R accept(Visitor&lt;C&gt; v, C c){ return v.&lt;R&gt;visit(this, c); }
}
<br>
class SubExp extends BinExp {
  SubExp(Exp left, Exp right){ super(left, right); }
  &lt;R, C&gt; R accept(Visitor&lt;C&gt; v, C c){ return v.&lt;R&gt;visit(this, c); }
}
<br>
class MulExp extends BinExp {
  MulExp(Exp left, Exp right){ super(left, right); }
  &lt;R, C&gt; R accept(Visitor&lt;C&gt; v, C c){ return v.&lt;R&gt;visit(this, c); }
}
<br>
class DivExp extends BinExp {
  DivExp(Exp left, Exp right){ super(left, right); }
  &lt;R, C&gt; R accept(Visitor&lt;C&gt; v, C c){ return v.&lt;R&gt;visit(this, c); }
}
<br>
class IntExp extends Exp {
  final int value;
  IntExp(int value){ this.value = value; }
  &lt;R, C&gt; R accept(Visitor&lt;C&gt; v, C c){ return v.&lt;R&gt;visit(this, c); }
}
<br>
class VarExp extends Exp {
  final String name;
  VarExp(String name){ this.name = name; }
  &lt;R, C&gt; R accept(Visitor&lt;C&gt; v, C c){ return v.&lt;R&gt;visit(this, c); }
}
<br>
class SetExp extends Exp {
  final String name;
  final Exp exp;
  SetExp(String name, Exp exp){ this.name = name; this.exp = exp; }
  &lt;R, C&gt; R accept(Visitor&lt;C&gt; v, C c){ return v.&lt;R&gt;visit(this, c); }
}
<br>
class BlkExp extends Exp {
  final List&lt;? extends Exp&gt; exps;
  BlkExp(Exp... exps){
    this.exps = Arrays.asList(exps);
  }
  &lt;R, C&gt; R accept(Visitor&lt;C&gt; v, C c){ return v.&lt;R&gt;visit(this, c); }
}
</pre></div><div class="section">
<h3><a href="./?date=20061028#p02"><span class="sanchor">_</span></a> [<a href="./?year=2006;month=4Q;category=Java">Java</a>]キャスト推論</h3><p>
引き続き、Genericsネタ。ただし、今度のは全く役に立たないが。
</p>
<p>
Javaの多相メソッドでは、メソッド呼び出しを書く際に、型引数について、メソッド呼び出しの引数や返り値を代入する変数の型からある程度推論してくれる。このことを利用すると、例えば<a href="https://web.archive.org/web/20070327065727/http://www.coins.tsukuba.ac.jp/~i021216/diary/?date=20051003#p02">2005-10-03の日記</a>のような型安全なリストリテラルを簡単に作るメソッドを作ることができる。
</p>
<p>
今回のネタは、この推論機構を悪用して、どの型にキャストするのかを書かずにキャストを行うことができるメソッドを定義するというもの。
</p>
<p>
まず、キャストを行うメソッドの定義は、次のようになる。
<pre>
public class Util {
  private static &lt;P, R&gt; R cast(P param){
    return (R)param;
  }
}
</pre>
<p>
メソッドの定義は実にシンプルで、２つの型をP, Rを型引数に取り、P型の値をただ単にR型にキャストする多相メソッドcastを定義しているだけ。
</p>
<p>
一方、これを使う側のコードは次のようになる。
</p>
<pre>
public class Main {
  public static void main(String[] args){
    Object o = "Hello, World";//Object型に文字列を入れておく
    String s = Util.cast(o);//Util.&lt;Object, String&gt;cast(o);と推論される
    System.out.println(s);
  }
}
</pre>
<p>
このようにキャストする型名を書かずにキャストできるわけだが、Genericsを使う前提ならキャストはほとんど書かないし、castメソッドの呼び出し結果を変数に代入しないとちゃんと推論してくれないため、実用性はほとんど無い。
</p></div>

</div>

<div class="comment">

		<div class="caption">本日のツッコミ(全1件) [<a href="./?date=20061028#c">ツッコミを入れる</a>]</div>
		<div class="commentshort">
				<p><a href="./?date=20061028#c01"><span class="canchor">_</span></a>
				<span class="commentator">testeras</span>&nbsp;[People who know Bob Miller here?  need icq nubmer of bob m..]</p>
		</div>
</div>







		<div class="referer">
		本日のリンク元 | <a href="https://web.archive.org/web/20070327065727/http://www.hostones.com/websites/fetish/zamnoy/" title="http://www.hostones.com/websites/fetish/zamnoy/">428</a> | <a href="https://web.archive.org/web/20070327065727/http://zakovka.porkyhost.com/" title="http://zakovka.porkyhost.com/">348</a> | <a href="https://web.archive.org/web/20070327065727/http://vsemoe.sultryserver.com/" title="http://vsemoe.sultryserver.com/">347</a> | <a href="https://web.archive.org/web/20070327065727/http://prodaza.porkyhost.com/" title="http://prodaza.porkyhost.com/">347</a> | <a href="https://web.archive.org/web/20070327065727/http://www2.xfreehosting.com/hardcore/navsegda/" title="http://www2.xfreehosting.com/hardcore/navsegda/">346</a> | <a href="https://web.archive.org/web/20070327065727/http://www.hostones.com/websites/amateurs/zaebun/" title="http://www.hostones.com/websites/amateurs/zaebun/">346</a> | <a href="https://web.archive.org/web/20070327065727/http://www.nastyhost.com/members/sovsem/" title="http://www.nastyhost.com/members/sovsem/">345</a> | <a href="https://web.archive.org/web/20070327065727/http://glazam.sultryserver.com/" title="http://glazam.sultryserver.com/">344</a> | <a href="https://web.archive.org/web/20070327065727/http://www.nastyhost.com/members/veselis/" title="http://www.nastyhost.com/members/veselis/">341</a> | <a href="https://web.archive.org/web/20070327065727/http://www2.xfreehosting.com/fetish/zanyato/" title="http://www2.xfreehosting.com/fetish/zanyato/">339</a> | <a href="./?date=20061028#t">TrackBack(0)</a>
		</div>
</div>


	<hr class="sep">
	
<div class="day">
<h2><span class="date"><a href="./?date=20061029">2006-10-29</a></span> <span class="title"></span></h2>

<div class="body">

<div class="section">
<h3><a href="./?date=20061029#p01"><span class="sanchor">_</span></a> [<a href="./?year=2006;month=4Q;category=%A4%BD%A4%CE%C2%BE">その他</a>]体調不良</h3><p>
今日は一日、なんか体調が悪い。やたらに鼻水が出るし、体がだるい。風邪引いたかなあ。
</p></div>

</div>

<div class="comment">

	<div class="caption">[<a href="./?date=20061029#c">ツッコミを入れる</a>]</div>
</div>







		<div class="referer">
		本日のリンク元 | <a href="https://web.archive.org/web/20070327065727/http://www2.xfreehosting.com/fetish/zanyato/" title="http://www2.xfreehosting.com/fetish/zanyato/">677</a> | <a href="https://web.archive.org/web/20070327065727/http://www.hostones.com/websites/amateurs/zaebun/" title="http://www.hostones.com/websites/amateurs/zaebun/">433</a> | <a href="https://web.archive.org/web/20070327065727/http://www.hostones.com/websites/fetish/zamnoy/" title="http://www.hostones.com/websites/fetish/zamnoy/">425</a> | <a href="https://web.archive.org/web/20070327065727/http://prodaza.porkyhost.com/" title="http://prodaza.porkyhost.com/">403</a> | <a href="https://web.archive.org/web/20070327065727/http://glazam.sultryserver.com/" title="http://glazam.sultryserver.com/">344</a> | <a href="https://web.archive.org/web/20070327065727/http://vsemoe.sultryserver.com/" title="http://vsemoe.sultryserver.com/">343</a> | <a href="https://web.archive.org/web/20070327065727/http://www2.xfreehosting.com/hardcore/navsegda/" title="http://www2.xfreehosting.com/hardcore/navsegda/">341</a> | <a href="https://web.archive.org/web/20070327065727/http://www.nastyhost.com/members/veselis/" title="http://www.nastyhost.com/members/veselis/">340</a> | <a href="https://web.archive.org/web/20070327065727/http://www.nastyhost.com/members/sovsem/" title="http://www.nastyhost.com/members/sovsem/">334</a> | <a href="https://web.archive.org/web/20070327065727/http://zakovka.porkyhost.com/" title="http://zakovka.porkyhost.com/">332</a> | <a href="./?date=20061029#t">TrackBack(0)</a>
		</div>
</div>


	<hr class="sep">
	
<div class="day">
<h2><span class="date"><a href="./?date=20061030">2006-10-30</a></span> <span class="title"></span></h2>

<div class="body">

<div class="section">
<h3><a href="./?date=20061030#p01"><span class="sanchor">_</span></a> [<a href="./?year=2006;month=4Q;category=Nemerle">Nemerle</a>]printfマクロ</h3><p>
今日のお題はprintf相当のマクロ。といっても、フルスペックのprintfを実装するのは大変だし、既にNemerleには標準でPrintfマクロがあるので、仕様は最小限のものに留めておく。
</p>
<p>
具体的には、大体次のような仕様にする。
</p>
<ul>
<li>変換指定子は%dのみ</li>
<li>桁数の指定などの機能は一切無し</li>
<li>変換指定子に対して、引数の数が多すぎたり少なすぎたりした場合は、エラーメッセージを表示する</li>
<li>変換指定子に対して、合わない型の引数が渡された場合はエラーメッセージを表示する</li>
</ul>
<p>
仕様としては少ししょぼすぎるが、今回は、マクロ内での型チェックの方法と可変長引数のマクロの処理の方法を学ぶのが目的なので、これでいいのだ。というわけで、以下がソース。Nemerleにまだそんなに慣れていないせいもあって、予想外に行数が増えてしまった。
</p>
<p><strong>printf.n</strong>
<pre>
using System;
using System.Text;
using Nemerle.Collections;
using Nemerle.Macros;
using Nemerle.Compiler;
using C = System.Console;
using P = Nemerle.Compiler.Parsetree;
<br>
macro Printf(format :string, params args : array[expr]){
  def tokenize(f: string) : list[string] {
    def flag() {
      when(f.Length == 1){
        throw ArgumentException("flag name must be specified after '%'");
      }
      match(f[1]){
      | 'd' =&gt; ("%d", f.Substring(2))
      | '%' =&gt; ("%%", f.Substring(2))
      | _   =&gt; throw ArgumentException(
          "illegal flag '" + f.Substring(0, 2) + "'"
        )
      }
    }
    def cont() {
      def x = match(f.IndexOf('%')){
      | -1 =&gt; f.Length
      | n  =&gt; n
      }
      (f.Substring(0, x), f.Substring(x, f.Length - x));
    }
    if(f.Length == 0){
      [];
    }else{
      def (token, rest) = match(f[0]){
      | '%' =&gt; flag()
      | _   =&gt; cont()
      };
      token :: tokenize(rest);
    }
  }
  def parse(tokens :list[string], args :array[P.PExpr]) :list[P.PExpr] {
    mutable x = 0;
    def exprs = List.Map(tokens, fun(t :string){
    | "%d" =&gt; 
      if(x &gt;= args.Length){
        Message.Error("not enough arguments");
        &lt;[ C.Write("%d") ]&gt;
      }else{
        def arg = args[x];
        x++;
        &lt;[ C.Write($arg : int) ]&gt;;
      }
    | "%%" =&gt; &lt;[ C.Write("%") ]&gt;
    | _    =&gt; &lt;[ C.Write($(t :string)) ]&gt;
    });
    when(x &lt; args.Length){
      Message.Error("too many arguments");
    }
    exprs;
  }
  def exprs = parse(tokenize(format), args);
  &lt;[ {.. $exprs} ]&gt;;
}
</pre>
<p>
これを使う側のソースは、次のような感じになる。
</p>
<p><strong>use_printf.n</strong></p>
<pre>
def a = 10;
def b = 20;
Printf("%d + %d = %d\n", a, b, a + b);
</pre>
<p>
コンパイルして実行すると、無事、以下のように表示される。
</p>
<pre>
10 + 20 = 30
</pre>
<p>
また、次のように間違った型の引数を与えると、
</p>
<pre>
def a = 10;
def b = 20;
Printf("%d + %d = %d\n", a, b, "Hello");
</pre>
<p>
ちゃんとエラーメッセージが表示される。
</p>
<pre>
use_printf.n:3:1:3:7: [01;31merror [0m: expected int, got string in type-enforc
ed expression: System.String is not a subtype of System.Int32 [simple require]
</pre></div>

</div>

<div class="comment">

		<div class="caption">本日のツッコミ(全6件) [<a href="./?date=20061030#c">ツッコミを入れる</a>]</div>
		<div class="commentshort">
			<p><a href="./?date=20061030#c01">Before...</a></p>
				<p><a href="./?date=20061030#c02"><span class="canchor">_</span></a>
				<span class="commentator">みずしま</span>&nbsp;[すみません。確かにvalidなRDFになっていなかったようなので、修正しておきました。  ]</p>
				<p><a href="./?date=20061030#c03"><span class="canchor">_</span></a>
				<span class="commentator">testeras</span>&nbsp;[People who know Bob Miller here?  need icq nubmer of bob m..]</p>
				<p><a href="./?date=20061030#c04"><span class="canchor">_</span></a>
				<span class="commentator">BALSALAZIDE-DISODIUM-1670551867</span>&nbsp;[  &lt;h1&gt;balsalazide disodium&lt;/h1&gt;    %pdf-1.2  &lt;br&gt;%  &lt;br&gt;18..]</p>
				<p><a href="./?date=20061030#c05"><span class="canchor">_</span></a>
				<span class="commentator">ATENOLOL--1220585207</span>&nbsp;[&quot;next   &lt;br&gt;generic name:   ]</p>
				<p><a href="./?date=20061030#c06"><span class="canchor">_</span></a>
				<span class="commentator">BUPROPION-HYDROCHLORIDE--1812860574</span>&nbsp;[  &lt;h1&gt;bupropion hydrochloride&lt;/h1&gt;      &lt;br&gt;bupropion  &lt;br..]</p>
		</div>
</div>







		<div class="referer">
		本日のリンク元 | <a href="https://web.archive.org/web/20070327065727/http://www.hostones.com/websites/fetish/zamnoy/" title="http://www.hostones.com/websites/fetish/zamnoy/">435</a> | <a href="https://web.archive.org/web/20070327065727/http://www.hostones.com/websites/amateurs/zaebun/" title="http://www.hostones.com/websites/amateurs/zaebun/">418</a> | <a href="https://web.archive.org/web/20070327065727/http://www.nastyhost.com/members/sovsem/" title="http://www.nastyhost.com/members/sovsem/">341</a> | <a href="https://web.archive.org/web/20070327065727/http://glazam.sultryserver.com/" title="http://glazam.sultryserver.com/">341</a> | <a href="https://web.archive.org/web/20070327065727/http://vsemoe.sultryserver.com/" title="http://vsemoe.sultryserver.com/">340</a> | <a href="https://web.archive.org/web/20070327065727/http://www2.xfreehosting.com/hardcore/navsegda/" title="http://www2.xfreehosting.com/hardcore/navsegda/">335</a> | <a href="https://web.archive.org/web/20070327065727/http://www.nastyhost.com/members/veselis/" title="http://www.nastyhost.com/members/veselis/">335</a> | <a href="https://web.archive.org/web/20070327065727/http://www2.xfreehosting.com/fetish/zanyato/" title="http://www2.xfreehosting.com/fetish/zanyato/">331</a> | <a href="https://web.archive.org/web/20070327065727/http://www.google.it/search?hl=it&amp;q=w.w.w.jessicarizzo.it&amp;meta=lr%3Dlang_it" title="http://www.google.it/search?hl=it&amp;q=w.w.w.jessicar...">22</a> | <a href="https://web.archive.org/web/20070327065727/http://www.google.it/search?hl=it&amp;q=nane+e+nani+porno+gallery&amp;btnG=Cerca&amp;meta=" title="http://www.google.it/search?hl=it&amp;q=nane e nani po...">15</a> | <a href="./?date=20061030#t">TrackBack(0)</a>
		</div>
</div>


	<hr class="sep">
	
<div class="day">
<h2><span class="date"><a href="./?date=20061031">2006-10-31</a></span> <span class="title"></span></h2>

<div class="body">

<div class="section">
<h3><a href="./?date=20061031#p01"><span class="sanchor">_</span></a> [<a href="./?year=2006;month=4Q;category=Java">Java</a>]<a href="https://web.archive.org/web/20070327065727/http://blog.livedoor.jp/lalha_java/archives/50741760.html">Java Programming Tips - クラスローダーを自作する方法</a></h3><p>
<a href="https://web.archive.org/web/20070327065727/http://cappuccino.jp/keisuken/logbook/">航海日誌</a>経由。
</p>
<p>
クラスローダを自作する方法についての簡単な紹介。クラスローダを自作したい人にとってのとっかかりとして、良いと思う。ただ、はてなブックマークでもつっこまれてたが、これだとURLClassLoaderでいいじゃんとなってしまい、独自クラスローダを作るメリットがイマイチわかりにくいのではという気もする。
</p>
<p>
ちなみに、JVM上で動作してバイトコードにコンパイルできるスクリプト言語処理系(Pnuts/Rhino/Groovy/...)は、ほとんどの場合、独自クラスローダを使ってその仕組みを実現している。Onionでもスクリプトを直接実行するモードでは独自クラスローダを作っており、ソースコードをコンパイルしたバイト列からクラスをロードして実行するようにしている。
</p></div>

</div>

<div class="comment">

		<div class="caption">本日のツッコミ(全2件) [<a href="./?date=20061031#c">ツッコミを入れる</a>]</div>
		<div class="commentshort">
				<p><a href="./?date=20061031#c01"><span class="canchor">_</span></a>
				<span class="commentator">IKeJI</span>&nbsp;[ライブラリインジェクション(DLLインジェクションみたいなの)ができる？  ]</p>
				<p><a href="./?date=20061031#c02"><span class="canchor">_</span></a>
				<span class="commentator">みずしま</span>&nbsp;[ライブラリインジェクションという言葉が具体的に 何を指しているかによると思うけど、DLLインジェクション みたいに別..]</p>
		</div>
</div>







		<div class="referer">
		本日のリンク元 | <a href="https://web.archive.org/web/20070327065727/http://www2.xfreehosting.com/fetish/zanyato/" title="http://www2.xfreehosting.com/fetish/zanyato/">2679</a> | <a href="https://web.archive.org/web/20070327065727/http://www.nastyhost.com/members/veselis/" title="http://www.nastyhost.com/members/veselis/">1674</a> | <a href="https://web.archive.org/web/20070327065727/http://www2.xfreehosting.com/hardcore/navsegda/" title="http://www2.xfreehosting.com/hardcore/navsegda/">1670</a> | <a href="https://web.archive.org/web/20070327065727/http://prodaza.porkyhost.com/" title="http://prodaza.porkyhost.com/">1458</a> | <a href="https://web.archive.org/web/20070327065727/http://glazam.sultryserver.com/" title="http://glazam.sultryserver.com/">1357</a> | <a href="https://web.archive.org/web/20070327065727/http://zakovka.porkyhost.com/" title="http://zakovka.porkyhost.com/">1324</a> | <a href="https://web.archive.org/web/20070327065727/http://www.nastyhost.com/members/sovsem/" title="http://www.nastyhost.com/members/sovsem/">1019</a> | <a href="https://web.archive.org/web/20070327065727/http://vsemoe.sultryserver.com/" title="http://vsemoe.sultryserver.com/">1018</a> | <a href="https://web.archive.org/web/20070327065727/http://www.hostones.com/websites/fetish/zamnoy/" title="http://www.hostones.com/websites/fetish/zamnoy/">1005</a> | <a href="https://web.archive.org/web/20070327065727/http://www.hostones.com/websites/amateurs/zaebun/" title="http://www.hostones.com/websites/amateurs/zaebun/">905</a> | <a href="./?date=20061031#t">TrackBack(0)</a>
		</div>
</div>


	<hr class="sep">

<center>
Mizushima Kota/e-mail: i021216{at}coins.tsukuba.ac.jp/SKype ID: mizu_standard
</center>




<div class="footer">
Generated by <a href="https://web.archive.org/web/20070327065727/http://www.tdiary.org/">tDiary</a> version 2.0.0<br>
Powered by <a href="https://web.archive.org/web/20070327065727/http://www.ruby-lang.org/">Ruby</a> version 1.8.2
</div>
</body>
</html>
<!--
     FILE ARCHIVED ON 06:57:27 Mar 27, 2007 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 05:42:25 Nov 23, 2025.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  captures_list: 0.52
  exclusion.robots: 0.04
  exclusion.robots.policy: 0.031
  esindex: 0.008
  cdx.remote: 31.584
  LoadShardBlock: 191.514 (3)
  PetaboxLoader3.datanode: 152.181 (4)
  PetaboxLoader3.resolve: 190.975 (2)
  load_resource: 229.198
-->